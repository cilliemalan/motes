pipelines:
  build:
    group: motes
    label_template: "${github[:8]}"
    locking: off
    materials:
      github:
        git: https://github.com/cilliemalan/motes.git
        branch: master
    stages:
      - checks:
        jobs:
          environment:
            - script: printenv
          docker:
            - script: "docker --version"
          kubernetes:
            - script: "kubectl version"
          terraform:
            - script: "terraform --version"
          node:
            - script: |
                node --version
                npm --version
      - prerequisites:
          jobs:
            npm:
              tasks:
                - script: |
                    cd web
                    npm install
      - tests:
          jobs:
            runtests:
              - script: |
                  cd web
                  npm test